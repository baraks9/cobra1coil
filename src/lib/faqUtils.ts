import { Service, City } from './data';

export interface FAQItem {
  question: string;
  answer: string;
}

export interface FAQTemplate {
  questions: {
    q: string[]; // Multiple question variations
    a: string[]; // Multiple answer variations for uniqueness
  }[];
}

export const faqTemplates: Record<string, FAQTemplate> = {
  'rat-catcher': {
    questions: [
      {
        q: [
          "תוך כמה זמן מגיע לוכד חולדות ל{city}?",
          "מה זמן ההגעה של לוכד חולדות ב{city}?",
          "צריך לוכד חולדות ב{city} עכשיו - מתי תגיעו?"
        ],
        a: [
          "אנו מפעילים צוותים בפריסה רחבה ב{city}, מה שמאפשר לנו להגיע אליך תוך פחות מ-40 דקות ברוב שעות היממה.",
          "המדבירים שלנו נמצאים בקרבת {city} באופן קבוע, לכן זמן ההגעה הממוצע לקריאת חירום הוא כ-30 עד 60 דקות.",
          "בזכות הזמינות הגבוהה שלנו באזור {city}, נוכל לשלוח לוכד מוסמך שיגיע אליך במהירות המרבית, בדרך כלל תוך שעה אחת.",
          "הצוות שלנו ב{city} ערוך לקריאות דחופות ומגיע לרוב תוך 45 דקות לכל כתובת בעיר."
        ]
      },
      {
        q: [
          "האם אתם משתמשים ברעלים ללכידת חולדות ב{city}?",
          "איך אתם לוכדים חולדות ב{city} - עם רעל או בלי?",
          "האם הדברת חולדות ב{city} בטוחה לחיות מחמד?"
        ],
        a: [
          "אנו מעדיפים שימוש במלכודות הומניות ומתקדמות. במידה ונדרש שימוש ברעל, הוא נעשה בתוך תיבות האכלה בטיחותיות ונעולות.",
          "בטיחות הלקוחות שלנו ב{city} היא מעל הכל. אנו משתמשים בשיטות לכידה ללא רעלים ככל הניתן, ובמקרה הצורך משתמשים בחומרים המאושרים על ידי המשרד להגנת הסביבה.",
          "השיטה שלנו ב{city} מבוססת על ניטור ואיטום. אנו משתמשים ברעלים רק כמוצא אחרון ובצורה מבוקרת מאוד בתוך תיבות בטיחות.",
          "ב{city} אנו שמים דגש על הדברה ירוקה. לכידת חולדות מתבצעת בעיקר בעזרת מלכודות, ושימוש ברעלים נעשה במינימום ההכרחי ובצורה בטוחה."
        ]
      }
    ]
  },
  'termites': {
    questions: [
      {
        q: [
          "האם טרמיטים נפוצים בבניינים ב{city}?",
          "יש בעיית טרמיטים ב{city}?",
          "איך יודעים אם יש טרמיטים בבית ב{city}?"
        ],
        a: [
          "כן, אזור {city} ידוע בפעילות טרמיטים ערה עקב סוג הקרקע. אנו ממליצים על בדיקה שנתית למשקופים ורהיטי עץ.",
          "לצערינו אנו נתקלים בהרבה מקרי טרמיטים ב{city}. חשוב לזהות את הבעיה מוקדם כדי למנוע נזק בלתי הפיך ליסודות הבית.",
          "ב{city} ישנה נגיעות של טרמיטי קרקע. הטיפול שלנו כולל יצירת חסם כימי סביב המבנה להגנה מקסימלית.",
          "כחלק מהשירות שלנו ב{city}, אנו מבצעים בדיקות יסודיות לזיהוי טרמיטים, שכן הם נפוצים מאוד באזור זה."
        ]
      },
      {
        q: [
          "כמה זמן נמשכת האחריות על הדברת טרמיטים ב{city}?",
          "יש אחריות על טיפול בטרמיטים ב{city}?",
          "לכמה זמן תקפה האחריות להדברת טרמיטים ב{city}?"
        ],
        a: [
          "אנו מעניקים אחריות מלאה בכתב ל-5 שנים על כל טיפול בטרמיטים ב{city}, כולל בדיקות תקופתיות.",
          "הטיפול שלנו ב{city} כולל אחריות ארוכת טווח ל-5 שנים. אנחנו עומדים מאחורי איכות העבודה והחומרים שלנו.",
          "בגלל מורכבות הטיפול, לקוחותינו ב{city} מקבלים תעודת אחריות ל-5 שנים המבטיחה שקט נפשי מלא.",
          "אנו מתחייבים לתוצאות ב{city} ומספקים אחריות ל-5 שנים, מה שמראה על הביטחון שלנו בשיטת הטיפול."
        ]
      }
    ]
  },
  'default': {
    questions: [
      {
        q: [
          "כמה עולה שירות {service} ב{city}?",
          "מה המחיר של {service} ב{city}?",
          "כמה תעלה לי הדברת {service} ב{city}?"
        ],
        a: [
          "המחיר ל{service} ב{city} מתחיל בדרך כלל מ-{price} ש\"ח. המחיר הסופי נקבע לפי גודל הדירה (מספר חדרים) וחומרת הנגיעות. אנו מתחייבים למחיר הוגן ושקיפות מלאה מול תושבי {city}.",
          "עלות {service} באזור {city} נעה בין {price} ש\"ח לטיפול בסיסי ועד למחירים מותאמים אישית לבתים פרטיים או חצרות גדולות. התקשרו לקבלת הצעת מחיר מדויקת ללא התחייבות.",
          "ב{city}, שירותי ה{service} שלנו מתומחרים בצורה תחרותית, החל מ-{price} ש\"ח. המחיר כולל אחריות מלאה בכתב ושימוש בחומרים ירוקים המאושרים על ידי המשרד להגנת הסביבה.",
          "אנו מציעים מחירים הוגנים ל{service} ב${city}. טיפול סטנדרטי מתחיל ב-{price} ש\"ח, ותמיד תקבלו הצעת מחיר ברורה לפני תחילת העבודה."
        ]
      },
      {
        q: [
          "האם חומרי ההדברה בטוחים לילדים וחיות מחמד ב{city}?",
          "האם ה{service} ב{city} מסוכנת לילדים?",
          "האם צריך לצאת מהבית בזמן {service} ב{city}?"
        ],
        a: [
          "בהחלט. אנו משתמשים בחומרים ירוקים על בסיס פירטרואידים, המאושרים לשימוש ביתי ובטוחים לחלוטין לאחר ייבוש קצר.",
          "בכל הדברה שאנו מבצעים ב{city}, אנו שמים דגש על בטיחות. החומרים מאושרים על ידי המשרד להגנת הסביבה ואינם מסוכנים לדיירי הבית.",
          "אנו משתמשים בשיטות הדברה מתקדמות ובטוחות. לאחר הטיפול ב{city}, נספק לכם הנחיות ברורות מתי ניתן לחזור לבית בבטחה.",
          "בטיחות המשפחה שלכם ב{city} היא בראש סדר העדיפויות שלנו. אנו משתמשים בחומרים בטוחים ומספקים הנחיות ברורות לכל לקוח."
        ]
      },
      {
        q: [
          "האם אתם נותנים אחריות על {service} ב{city}?",
          "יש אחריות על {service} ב{city}?",
          "מה קורה אם המזיקים חוזרים אחרי {service} ב{city}?"
        ],
        a: [
          "בהחלט. כל הדברה ב{city} מגיעה עם תעודת אחריות בכתב. משך האחריות משתנה לפי סוג המזיק, למשל הדברת ג'וקים ב${city} כוללת לרוב אחריות ל-6 חודשים.",
          "כן, אנו עומדים מאחורי העבודה שלנו ב${city}. תקבלו אחריות מלאה המבטיחה שאם המזיק חוזר בתקופת האחריות, אנחנו מגיעים לטיפול חוזר ללא עלות נוספת.",
          "אחריות היא חלק בלתי נפרד מהשירות שלנו ב${city}. אנו מבטיחים פתרון מלא לבעיה ומספקים תעודת אחריות מסודרת בסיום העבודה."
        ]
      }
    ]
  }
};

/**
 * Selects a deterministic variation based on a string (e.g., city name)
 */
function getVariation<T>(items: T[], seed: string): T {
  let hash = 0;
  for (let i = 0; i < seed.length; i++) {
    hash = seed.charCodeAt(i) + ((hash << 5) - hash);
  }
  const index = Math.abs(hash) % items.length;
  return items[index];
}

export function getUniqueFAQ(service: Service, city?: City): FAQItem[] {
  const cityName = city?.name || "כל הארץ";
  const template = faqTemplates[service.id] || faqTemplates['default'];
  const price = service.avgPrice.split('-')[0];

  return template.questions.map(item => {
    // Deterministically pick a question variation
    const rawQuestion = getVariation(item.q, cityName + item.q[0]);
    const question = rawQuestion
      .replace(/{city}/g, cityName)
      .replace(/{service}/g, service.name);
    
    // Use city name + the selected question as seed for deterministic answer choice
    const seed = cityName + rawQuestion;
    const rawAnswer = getVariation(item.a, seed);
    
    const answer = rawAnswer
      .replace(/{city}/g, cityName)
      .replace(/{service}/g, service.name)
      .replace(/{price}/g, price);

    return { question, answer };
  });
}
